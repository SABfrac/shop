

#  High-Load Product Import & Sync System

–í—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏–º–ø–æ—Ä—Ç–∞ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ –æ—Ç —Å–æ—Ç–µ–Ω —Ç—ã—Å—è—á –ø—Ä–æ–¥–∞–≤—Ü–æ–≤. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–∏–ª–ª–∏–æ–Ω—ã —Å—Ç—Ä–æ–∫ –≤ CSV-—Ñ–∞–π–ª–∞—Ö, –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é, –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PostgreSQL + OpenSearch.

---

##  –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üì• –ò–º–ø–æ—Ä—Ç –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ **–º–∏–ª–ª–∏–æ–Ω–æ–≤ —Å—Ç—Ä–æ–∫** –∏–∑ CSV-—Ñ–∏–¥–æ–≤
- üîÅ **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è** —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ `match_key`, GTIN, variant_hash
- üßπ **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è** –¥–∞–Ω–Ω—ã—Ö: –±—Ä–µ–Ω–¥—ã, –Ω–∞–∑–≤–∞–Ω–∏—è, –≥–∞—Ä–∞–Ω—Ç–∏—è, —Ü–≤–µ—Ç–∞ –∏ –¥—Ä.
- ‚ö° **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** —á–µ—Ä–µ–∑ RabbitMQ (–ø–∞—Ä—Å–∏–Ω–≥ ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è)
- üîç –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π **–ø–æ–∏—Å–∫** —á–µ—Ä–µ–∑ OpenSearch —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –∞—Ç—Ä–∏–±—É—Ç–∞–º
- üñºÔ∏è **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** —á–µ—Ä–µ–∑ Imaginary (resize/fit/crop) + MinIO
- üìä –û—Ç—á—ë—Ç–Ω–æ—Å—Ç—å: –æ—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ CSV –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–¥–∞–≤—Ü–∞
- –ú–µ—Ç—Ä–∏–∫–∏:–æ–±—â–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∏–¥–∞ ,–≤—Ä–µ–º—è –ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–∞ –≤ –ë–î,Opensearch
- ‚úÖ **–ü–æ–∫—Ä—ã—Ç–∏–µ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞–º–∏** –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (Codeception + mocks)

---

## üß© –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç          | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è                          |
|--------------------|-------------------------------------|
| **Backend**        | PHP 8.2+, Yii2 (Advanced Template)  |
| **Frontend**       | Vue 3 + Vite                        |
| **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**    | PostgreSQL 16                       |
| **–ü–æ–∏—Å–∫**          | OpenSearch                          |
| **–û—á–µ—Ä–µ–¥–∏**        | RabbitMQ                            |
| **–ö—ç—à / –°–µ—Å—Å–∏–∏**   | Redis                               |
| **–•—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–¥–∏–∞** | MinIO (S3-compatible)               |
| **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** | Imaginary (libvips)         |
| **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**| Docker + docker-compose             |

---

## ‚öôÔ∏è –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞ (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker 24+
- Docker Compose v2+
- RAM ‚â• 16 –ì–ë (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 32 –ì–ë)
- Windows (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è WSL2)

### –®–∞–≥–∏

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repo-url>
cd <repo-dir>

# 2. –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose up -d

# 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ PHP
docker exec -it yii2_php composer install

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
docker exec -it yii2_php php yii migrate/up --interactive=0


###  –ü—Ä–∏–º–µ—Ä—ã –ø–æ–∫—Ä—ã—Ç—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

| –°—Ü–µ–Ω–∞—Ä–∏–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `testImportChunkSuccess` | –£—Å–ø–µ—à–Ω—ã–π –∏–º–ø–æ—Ä—Ç —á–∞–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö |
| `testImportChunkCategoryNotFound` | –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏: –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ |
| `testImportChunkFailsOnMissingSkuCode` | –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π |
| `testImportChunkDeduplicatesIdenticalRows` | –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫ |

### ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞
docker-compose exec php vendor/bin/codecept run unit services/OfferBulkImportServiceTest


### üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
```mermaid
flowchart LR
    A[Frontend<br/>Vue 3] --> B[Backend<br/>Yii2 API]
    B --> C[RabbitMQ<br/>Queues]
    C --> D[Workers<br/>PHP CLI]
    D --> E[(PostgreSQL)]
    D --> F[(OpenSearch)]
    
    classDef frontend fill:#4CAF50,stroke:#388E3C,color:white
    classDef backend fill:#2196F3,stroke:#0D47A1,color:white
    classDef queue fill:#FF9800,stroke:#E65100,color:white
    classDef worker fill:#9C27B0,stroke:#4A148C,color:white
    classDef storage fill:#607D8B,stroke:#263238,color:white
    
    class A frontend
    class B backend
    class C queue
    class D worker
    class E,F storage
```