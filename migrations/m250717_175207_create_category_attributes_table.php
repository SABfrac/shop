<?php

use yii\db\Migration;

/**
 * Handles the creation of table `{{%category_attributes}}`.
 */
class m250717_175207_create_category_attributes_table extends Migration
{
    /**
     * Для связи категорий и атрибутов, чтобы нельзя было выбрать любой атрибут для категолрии ,
     * определенная категория ограничена только своими атрибутами (пример: для категории одежа нельзя будет выбрать атрибут объем памяти)
     * {@inheritdoc}
     */
    public function safeUp()
    {
        $this->createTable('{{%category_attributes}}', [
            'category_id' => $this->integer()->notNull(),
            'attribute_id' => $this->integer()->notNull(),
            'sort_order' => $this->integer()->defaultValue(0),
            'PRIMARY KEY ([[category_id]], [[attribute_id]])',
        ]);

        // Внешние ключи
        $this->addForeignKey(
            'fk-category_attributes-category_id',
            '{{%category_attributes}}',
            'category_id',
            '{{%categories}}',
            'id',
            'CASCADE'
        );

        $this->addForeignKey(
            'fk-category_attributes-attribute_id',
            '{{%category_attributes}}',
            'attribute_id',
            '{{%attributes}}',
            'id',
            'CASCADE',

        );

        $this->createIndex('idx-category_attributes-category_id',
            'category_attributes',
            'category_id');
        $this->createIndex('idx-category_attributes-attribute_id',
            'category_attributes',
            'attribute_id');
        $this->createIndex(
            'idx-category_attributes-category_attribute',
            'category_attributes',
            ['category_id', 'attribute_id']);


        $this->batchInsert('category_attributes',
            ['category_id', 'attribute_id', 'sort_order'],
            $this->getCategoryAttributesData()
        );

    }

    /**
     * {@inheritdoc}
     */
    public function safeDown()
    {

        $this->dropTable('{{%category_attributes}}');
    }

    /**
     * Возвращает данные для вставки с учетом sort_order
     * @return array
     */
    private function getCategoryAttributesData(): array
    {
        return [
            // Смартфоны (11)
            [11, 1, 10], [11, 2, 20], [11, 3, 30], [11, 4, 40], [11, 5, 50],
            [11, 6, 60], [11, 7, 70], [11, 15, 80], [11, 16, 90],
            [11, 17, 100], [11, 18, 110], [11, 19, 120], [11, 20, 130],
            [11, 21, 140], [11, 22, 150],

            // Ноутбуки (12)
            [12, 1, 10], [12, 2, 20], [12, 3, 30], [12, 4, 40], [12, 5, 50],
            [12, 6, 60], [12, 15, 70], [12, 16, 80], [12, 17, 90],
            [12, 18, 100], [12, 19, 110], [12, 21, 120], [12, 22, 130], [12, 48, 140],

            // Телевизоры (14)
            [14, 1, 10], [14, 2, 20], [14, 3, 30], [14, 4, 40], [14, 5, 50],
            [14, 6, 60], [14, 19, 70], [14, 21, 80], [14, 22, 90],
            [14, 49, 100], [14, 50, 110], [14, 51, 120], [14, 52, 130],
            [14, 53, 140], [14, 54, 150], [14, 55, 160], [14, 56, 170], [14, 57, 180],

            // Процессоры (18)
            [18, 1, 10], [18, 2, 20], [18, 3, 30], [18, 5, 40], [18, 6, 50],
            [18, 15, 60], [18, 22, 70], [18, 26, 80],

            // Видеокарты (19)
            [19, 1, 10], [19, 2, 20], [19, 3, 30], [19, 5, 40], [19, 6, 50],
            [19, 22, 60], [19, 31, 70], [19, 49, 80],

            // Оперативная память (21)
            [21, 1, 10], [21, 2, 20], [21, 3, 30], [21, 5, 40], [21, 6, 50],
            [21, 16, 60], [21, 22, 70], [21, 48, 80],

            // Мужская одежда (26)
            [26, 1, 10], [26, 2, 20], [26, 3, 30], [26, 6, 40], [26, 7, 50],
            [26, 8, 60], [26, 9, 70], [26, 10, 80], [26, 11, 90],
            [26, 12, 100], [26, 13, 110], [26, 21, 120], [26, 22, 130],

            // Женская одежда (27)
            [27, 1, 10], [27, 2, 20], [27, 3, 30], [27, 6, 40], [27, 7, 50],
            [27, 8, 60], [27, 9, 70], [27, 10, 80], [27, 11, 90],
            [27, 12, 100], [27, 13, 110], [27, 21, 120], [27, 22, 130],

            // Джинсы (33, 42)
            [33, 1, 10], [33, 2, 20], [33, 3, 30], [33, 6, 40], [33, 7, 50],
            [33, 8, 60], [33, 9, 70], [33, 10, 80], [33, 11, 90],
            [33, 12, 100], [33, 13, 110], [33, 21, 120], [33, 22, 130],
            [42, 1, 10], [42, 2, 20], [42, 3, 30], [42, 6, 40], [42, 7, 50],
            [42, 8, 60], [42, 9, 70], [42, 10, 80], [42, 11, 90],
            [42, 12, 100], [42, 13, 110], [42, 21, 120], [42, 22, 130],

            // Верхняя одежда (37, 46)
            [37, 1, 10], [37, 2, 20], [37, 3, 30], [37, 6, 40], [37, 7, 50],
            [37, 8, 60], [37, 9, 70], [37, 10, 80], [37, 11, 90],
            [37, 12, 100], [37, 13, 110], [37, 21, 120], [37, 22, 130],
            [46, 1, 10], [46, 2, 20], [46, 3, 30], [46, 6, 40], [46, 7, 50],
            [46, 8, 60], [46, 9, 70], [46, 10, 80], [46, 11, 90],
            [46, 12, 100], [46, 13, 110], [46, 21, 120], [46, 22, 130],

            // Холодильники (82)
            [82, 1, 10], [82, 2, 20], [82, 3, 30], [82, 4, 40], [82, 5, 50],
            [82, 6, 60], [82, 21, 70], [82, 22, 80], [82, 37, 90], [82, 54, 100],

            // Стиральные машины (84)
            [84, 1, 10], [84, 2, 20], [84, 3, 30], [84, 4, 40], [84, 5, 50],
            [84, 6, 60], [84, 21, 70], [84, 22, 80], [84, 31, 90],
            [84, 33, 100], [84, 54, 110],

            // Кофеварки и кофемашины (92)
            [92, 1, 10], [92, 2, 20], [92, 3, 30], [92, 4, 40], [92, 5, 50],
            [92, 6, 60], [92, 21, 70], [92, 22, 80], [92, 29, 90],
            [92, 30, 100], [92, 31, 110], [92, 37, 120], [92, 54, 130],

            // Мебель (105)
            [105, 1, 10], [105, 2, 20], [105, 3, 30], [105, 6, 40],
            [105, 21, 50], [105, 22, 60], [105, 28, 70], [105, 54, 80],

            // Косметика (111)
            [111, 1, 10], [111, 2, 20], [111, 3, 30], [111, 4, 40],
            [111, 5, 50], [111, 6, 60], [111, 22, 70], [111, 37, 80],
            [111, 40, 90], [111, 41, 100],

            // Автозапчасти (141)
            [141, 1, 10], [141, 2, 20], [141, 3, 30], [141, 4, 40],
            [141, 5, 50], [141, 6, 60], [141, 22, 70], [141, 23, 80],
            [141, 24, 90], [141, 25, 100], [141, 26, 110], [141, 34, 120],

            // Тормозные колодки (180)
            [180, 1, 10], [180, 2, 20], [180, 3, 30], [180, 5, 40],
            [180, 6, 50], [180, 22, 60], [180, 23, 70], [180, 24, 80],
            [180, 25, 90], [180, 26, 100],

            // Аккумуляторы (187)
            [187, 1, 10], [187, 2, 20], [187, 3, 30], [187, 5, 40],
            [187, 6, 50], [187, 22, 60], [187, 23, 70], [187, 24, 80],
            [187, 25, 90], [187, 29, 100], [187, 30, 110],

            // Моторные масла (222, 226)
            [222, 1, 10], [222, 2, 20], [222, 3, 30], [222, 4, 40],
            [222, 5, 50], [222, 6, 60], [222, 22, 70], [222, 23, 80], [222, 37, 90],
            [226, 1, 10], [226, 2, 20], [226, 3, 30], [226, 4, 40],
            [226, 5, 50], [226, 6, 60], [226, 22, 70], [226, 23, 80], [226, 37, 90],

            // Фильтры (218-221)
            [218, 1, 10], [218, 2, 20], [218, 3, 30], [218, 5, 40],
            [218, 6, 50], [218, 22, 60], [218, 23, 70], [218, 24, 80], [218, 25, 90],
            [219, 1, 10], [219, 2, 20], [219, 3, 30], [219, 5, 40],
            [219, 6, 50], [219, 22, 60], [219, 23, 70], [219, 24, 80], [219, 25, 90],
            [220, 1, 10], [220, 2, 20], [220, 3, 30], [220, 5, 40],
            [220, 6, 50], [220, 22, 60], [220, 23, 70], [220, 24, 80], [220, 25, 90],
            [221, 1, 10], [221, 2, 20], [221, 3, 30], [221, 5, 40],
            [221, 6, 50], [221, 22, 60], [221, 23, 70], [221, 24, 80], [221, 25, 90],
        ];
    }

}
